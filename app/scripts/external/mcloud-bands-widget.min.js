// Materials Cloud bands structure widget v1.1.0
// 2020-07-13, MIT License
function getPathStringFromPathArray(a){var b=[],c="";return a.forEach(function(a){0===b.length?(b+=a[0],b+="-",b+=a[1]):(c!=a[0]&&(b+="|"+a[0]),b+="-",b+=a[1]),c=a[1]}),b}function getPathArrayFromPathString(a){var b=[],c=a.split("|");return c.forEach(function(a){var c=a.split("-"),d=c.map(function(a){return a.trim()}),e=d.filter(function(a){return""!==a});zip(e.slice(0,e.length-1),e.slice(1)).forEach(function(a){b.push([a[0],a[1]])})}),b}function getValidPointNames(a){var b=[];a.forEach(function(a){a.hasOwnProperty("paths")&&a.paths.forEach(function(a){b.push(a.from),b.push(a.to)})});var c=Array.from(new Set(b));return c.sort(),c}function BandPlot(a,b,c){this.divID=a,this.allData=[],this.allSeries=[],this.allColorInfo=[],this.currentPath=[],this.fermiEnergy=b,this.yLimit=c,this.yLabel="","undefined"!=typeof this.myChart&&this.myChart.destroy()}var zip=function(){var a=[].slice.call(arguments),b=0===a.length?[]:a.reduce(function(a,b){return a.length<b.length?a:b});return b.map(function(b,c){return a.map(function(a){return a[c]})})};BandPlot.prototype.addBandStructure=function(a,b){var c=["#555555","#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"];if("undefined"==typeof b){var d=this.allColorInfo.length,e=tinycolor(c[d%c.length]);b=[e.toHexString(),e.darken(20).toHexString(),e.brighten(20).toHexString()]}this.allColorInfo.push(b),this.allData.push(a)},BandPlot.prototype.initChart=function(a){var b=this,c={type:"scatter",data:{datasets:this.allSeries},options:{legend:{display:!1},animation:{duration:0},hover:{animationDuration:0,mode:null},responsiveAnimationDuration:0,elements:{line:{tension:0}},responsive:!0,maintainAspectRatio:!1,tooltips:!1,scales:{xAxes:[{display:!0,ticks:{callback:function(a,b,c){return this.options.customTicks[b].label}},customTicks:a,afterBuildTicks:function(a,b){return a.options.customTicks.map(function(a){return a.value})}}],yAxes:[{display:!0,ticks:{callback:function(a,b,c){return 0!==b&&b!=c.length-1?a:void 0}},scaleLabel:{display:!0},gridLines:{display:!1}}]},zoom:{enabled:!0,mode:"y",drag:!0}}};b.yLimit&&(c.options.scales.yAxes[0].ticks.min=b.yLimit.ymin,c.options.scales.yAxes[0].ticks.max=b.yLimit.ymax),b.xLimit&&(c.options.scales.xAxes[0].ticks.min=b.xLimit.xmin,c.options.scales.xAxes[0].ticks.max=b.xLimit.xmax),b.yLabel&&(c.options.scales.yAxes[0].scaleLabel.labelString=b.yLabel);var d=document.getElementById(this.divID).getContext("2d");b.myChart=new Chart(d,c)},BandPlot.prototype.getDefaultPath=function(){if(this.allData.length>0){var a=this.allData[0].path;return a}return[]},BandPlot.prototype.updateBandPlot=function(a,b){var c=this,d=null;void 0===b&&(b=!1);var e=.1;d="undefined"==typeof a?c.getDefaultPath():a;var f=!1;if(c.currentPath.length!=d.length?f=!0:zip(c.currentPath,d).forEach(function(a){a[0][0]!=a[1][0]&&(f=!0),a[0][1]!=a[1][1]&&(f=!0)}),f||b){c.currentPath=d;var g=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(d.from==a[0]&&d.to==a[1])return{segment:d,reverse:!1};if(d.from==a[1]&&d.to==a[0])return{segment:d,reverse:!0}}return null},h=0,i=[];c.allSeries=[],d.forEach(function(a,b){0===i.length?i.push([h,a[0]]):i[i.length-1][1]!=a[0]&&(i[i.length-1][1]+="|"+a[0]);var d,f=!1,j=null;c.allData.forEach(function(b,e){var i=g(a,b.paths);if(i){f=!0;var k=[],l=i.segment.x.length;if(i.reverse)for(d=i.segment.x.length-1;d>=0;d--)k.push(i.segment.x[l-1]-i.segment.x[d]);else for(d=0;l>d;d++)k.push(i.segment.x[d]-i.segment.x[0]);var m=i.segment.two_band_types||!1,n=i.segment.values.length;null===j&&(j=k[k.length-1]);var o=1;if(k[k.length-1]>0)for(o=j/k[k.length-1],d=0;d<k.length;d++)k[d]*=o;j>0&&i.segment.values.forEach(function(b,d){var f,g=[];if(f=i.reverse?b.slice().reverse():b,c.fermiEnergy){var j=f.map(function(a){return a-c.fermiEnergy});f=j}zip(k,f).forEach(function(a){g.push({x:a[0]+h,y:a[1]})});var l=c.allColorInfo[e],o=null;o=m?n>2*d?l[1]:l[2]:l[0];var p={label:a[0]+"-"+a[1]+"."+d,borderColor:o,borderWidth:2,data:g,fill:!1,showLine:!0,pointRadius:0};c.allSeries.push(p)})}}),h+=f&&j>0?j:e,i.push([h,a[1]])});var j=c.updateTicks(i),k=j.map(function(a,b){return{value:a[0],label:a[1]}});c.xLimit={xmin:0,xmax:h},c.yLabel=c.allData[0].Y_label,void 0===c.yLabel&&(c.yLabel="Electronic bands (eV)"),void 0===c.myChart?c.initChart(k):(c.myChart.options.scales.xAxes[0].customTicks=k,c.myChart.data.datasets=c.allSeries,c.myChart.options.scales.xAxes[0].ticks.max=h,c.myChart.update())}},BandPlot.prototype.resetZoom=function(){var a=this;a.myChart.resetZoom(),a.myChart.options.scales.xAxes[0].ticks.min=a.xLimit.xmin,a.myChart.options.scales.xAxes[0].ticks.max=a.xLimit.xmax,a.myChart.update()},BandPlot.prototype.updateTicks=function(a){var b,c=this,d=function(a,c){var d={};for(b=0;b<c.length;b++)d[c[b][0]]=c[b][1];var e=function(a){return a=a.replace(/GAMMA/gi,"Γ"),a=a.replace(/DELTA/gi,"Δ"),a=a.replace(/SIGMA/gi,"Σ"),a=a.replace(/LAMBDA/gi,"Λ"),a=a.replace(/\-/gi,"—"),a=a.replace(/_(.)/gi,function(a,b,c,d){switch(b){case"0":return"₀";case"1":return"₁";case"2":return"₂";case"3":return"₃";case"4":return"₄";case"5":return"₅";case"6":return"₆";case"7":return"₇";case"8":return"₈";case"9":return"₉"}return b})},f=function(a){return"G"==a&&(a="Γ"),a=a.replace(/\-/gi,"—"),a=a.replace(/(\d)/gi,function(a,b,c,d){switch(b){case"0":return"₀";case"1":return"₁";case"2":return"₂";case"3":return"₃";case"4":return"₄";case"5":return"₅";case"6":return"₆";case"7":return"₇";case"8":return"₈";case"9":return"₉"}return b})},g=getValidPointNames([a]),h=!1;h=-1!=g.findIndex(function(a){return"GAMMA"==a})?!1:-1!=g.findIndex(function(a){return"G"==a})?!0:!1;var i;return i=h?f:e,function(a){if("undefined"==typeof a)return a;var b=i(a);return b}},e=d(c.allData,a);return a.map(function(a){return[a[0],e(a[1])]})};